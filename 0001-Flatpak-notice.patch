From 6528a12754ad97be5603d858efcc7f54deb0521d Mon Sep 17 00:00:00 2001
From: mirkobrombin <send@mirko.pm>
Date: Tue, 22 Jun 2021 15:55:20 +0200
Subject: [PATCH] Flatpak notice

---
 src/ui/window.ui | 259 +++++++++++++++++++++++++++++++----------------
 src/window.py    |  10 ++
 2 files changed, 182 insertions(+), 87 deletions(-)

diff --git a/src/ui/window.ui b/src/ui/window.ui
index d88188b..b609735 100644
--- a/src/ui/window.ui
+++ b/src/ui/window.ui
@@ -1,22 +1,22 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<!-- Generated with glade 3.22.2 -->
+<!-- Generated with glade 3.38.2 -->
 <interface>
   <requires lib="gtk+" version="3.24"/>
   <requires lib="libhandy" version="1.0"/>
   <object class="GtkPopover" id="pop_downloads">
-    <property name="can_focus">False</property>
+    <property name="can-focus">False</property>
     <child>
       <object class="GtkBox">
-        <property name="width_request">160</property>
+        <property name="width-request">160</property>
         <property name="visible">True</property>
-        <property name="can_focus">False</property>
-        <property name="border_width">9</property>
+        <property name="can-focus">False</property>
+        <property name="border-width">9</property>
         <property name="orientation">vertical</property>
         <property name="spacing">3</property>
         <child>
           <object class="GtkBox" id="box_downloads">
             <property name="visible">True</property>
-            <property name="can_focus">False</property>
+            <property name="can-focus">False</property>
             <property name="orientation">vertical</property>
             <child>
               <placeholder/>
@@ -32,20 +32,20 @@
     </child>
   </object>
   <object class="GtkPopover" id="pop_menu">
-    <property name="can_focus">False</property>
+    <property name="can-focus">False</property>
     <child>
       <object class="GtkBox">
-        <property name="width_request">160</property>
+        <property name="width-request">160</property>
         <property name="visible">True</property>
-        <property name="can_focus">False</property>
-        <property name="border_width">9</property>
+        <property name="can-focus">False</property>
+        <property name="border-width">9</property>
         <property name="orientation">vertical</property>
         <property name="spacing">3</property>
         <child>
           <object class="GtkModelButton" id="btn_taskmanager">
             <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
+            <property name="can-focus">True</property>
+            <property name="receives-default">False</property>
             <property name="text" translatable="yes">Task manager</property>
           </object>
           <packing>
@@ -57,8 +57,8 @@
         <child>
           <object class="GtkModelButton" id="btn_importer">
             <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
+            <property name="can-focus">True</property>
+            <property name="receives-default">False</property>
             <property name="text" translatable="yes">Import and export</property>
           </object>
           <packing>
@@ -70,8 +70,8 @@
         <child>
           <object class="GtkModelButton" id="btn_preferences">
             <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
+            <property name="can-focus">True</property>
+            <property name="receives-default">False</property>
             <property name="text" translatable="yes">Preferences</property>
           </object>
           <packing>
@@ -83,7 +83,7 @@
         <child>
           <object class="GtkSeparator">
             <property name="visible">True</property>
-            <property name="can_focus">False</property>
+            <property name="can-focus">False</property>
           </object>
           <packing>
             <property name="expand">False</property>
@@ -94,8 +94,8 @@
         <child>
           <object class="GtkModelButton" id="btn_docs">
             <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
+            <property name="can-focus">True</property>
+            <property name="receives-default">False</property>
             <property name="text" translatable="yes">Documentation</property>
           </object>
           <packing>
@@ -107,8 +107,8 @@
         <child>
           <object class="GtkModelButton" id="btn_about">
             <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
+            <property name="can-focus">True</property>
+            <property name="receives-default">False</property>
             <property name="text" translatable="yes">About Bottles</property>
           </object>
           <packing>
@@ -121,20 +121,20 @@
     </child>
   </object>
   <object class="GtkPopover" id="pop_more">
-    <property name="can_focus">False</property>
+    <property name="can-focus">False</property>
     <child>
       <object class="GtkBox" id="box_more">
-        <property name="width_request">160</property>
+        <property name="width-request">160</property>
         <property name="visible">True</property>
-        <property name="can_focus">False</property>
-        <property name="border_width">9</property>
+        <property name="can-focus">False</property>
+        <property name="border-width">9</property>
         <property name="orientation">vertical</property>
         <property name="spacing">3</property>
         <child>
           <object class="GtkModelButton" id="btn_versioning">
             <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
+            <property name="can-focus">True</property>
+            <property name="receives-default">False</property>
             <property name="text" translatable="yes">Versioning</property>
           </object>
           <packing>
@@ -146,8 +146,8 @@
         <child>
           <object class="GtkModelButton" id="btn_installers">
             <property name="visible">True</property>
-            <property name="can_focus">True</property>
-            <property name="receives_default">False</property>
+            <property name="can-focus">True</property>
+            <property name="receives-default">False</property>
             <property name="text" translatable="yes">Installers</property>
           </object>
           <packing>
@@ -161,34 +161,34 @@
   </object>
   <template class="BottlesWindow" parent="HdyApplicationWindow">
     <property name="visible">True</property>
-    <property name="can_focus">False</property>
+    <property name="can-focus">False</property>
     <property name="title" translatable="yes">Bottles</property>
-    <property name="window_position">center</property>
-    <property name="default_width">800</property>
-    <property name="default_height">600</property>
-    <property name="icon_name">com.usebottles.bottles</property>
+    <property name="window-position">center</property>
+    <property name="default-width">800</property>
+    <property name="default-height">600</property>
+    <property name="icon-name">com.usebottles.bottles</property>
     <property name="gravity">center</property>
     <child>
       <object class="GtkBox">
         <property name="visible">True</property>
-        <property name="can_focus">False</property>
+        <property name="can-focus">False</property>
         <property name="orientation">vertical</property>
         <child>
           <object class="HdyHeaderBar">
             <property name="visible">True</property>
-            <property name="can_focus">False</property>
+            <property name="can-focus">False</property>
             <property name="title" translatable="yes">Bottles</property>
-            <property name="show_close_button">True</property>
-            <property name="centering_policy">strict</property>
+            <property name="show-close-button">True</property>
+            <property name="centering-policy">strict</property>
             <child type="title">
               <object class="HdySqueezer" id="squeezer">
                 <property name="visible">True</property>
-                <property name="can_focus">False</property>
+                <property name="can-focus">False</property>
                 <property name="homogeneous">True</property>
                 <child>
                   <object class="HdyViewSwitcher" id="view_switcher">
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
+                    <property name="can-focus">False</property>
                     <property name="stack">stack</property>
                   </object>
                 </child>
@@ -196,7 +196,7 @@
                   <object class="GtkLabel">
                     <property name="name">title_label</property>
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
+                    <property name="can-focus">False</property>
                     <property name="label">Bottles</property>
                     <attributes>
                       <attribute name="weight" value="bold"/>
@@ -208,94 +208,94 @@
             <child>
               <object class="GtkMenuButton" id="btn_menu">
                 <property name="visible">True</property>
-                <property name="can_focus">True</property>
-                <property name="focus_on_click">False</property>
-                <property name="receives_default">True</property>
-                <property name="tooltip_text" translatable="yes">Open menu</property>
+                <property name="can-focus">True</property>
+                <property name="focus-on-click">False</property>
+                <property name="receives-default">True</property>
+                <property name="tooltip-text" translatable="yes">Open menu</property>
                 <property name="popover">pop_menu</property>
                 <child>
                   <object class="GtkImage">
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="icon_name">open-menu-symbolic</property>
+                    <property name="can-focus">False</property>
+                    <property name="icon-name">open-menu-symbolic</property>
                   </object>
                 </child>
               </object>
               <packing>
-                <property name="pack_type">end</property>
+                <property name="pack-type">end</property>
               </packing>
             </child>
             <child>
               <object class="GtkMenuButton" id="btn_downloads">
                 <property name="visible">True</property>
-                <property name="can_focus">True</property>
-                <property name="focus_on_click">False</property>
-                <property name="receives_default">True</property>
-                <property name="tooltip_text" translatable="yes">Downloads</property>
+                <property name="can-focus">True</property>
+                <property name="focus-on-click">False</property>
+                <property name="receives-default">True</property>
+                <property name="tooltip-text" translatable="yes">Downloads</property>
                 <property name="popover">pop_downloads</property>
                 <child>
                   <object class="GtkImage">
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="icon_name">document-save-symbolic</property>
+                    <property name="can-focus">False</property>
+                    <property name="icon-name">document-save-symbolic</property>
                   </object>
                 </child>
               </object>
               <packing>
-                <property name="pack_type">end</property>
+                <property name="pack-type">end</property>
                 <property name="position">1</property>
               </packing>
             </child>
             <child>
               <object class="GtkMenuButton" id="btn_more">
-                <property name="can_focus">True</property>
-                <property name="focus_on_click">False</property>
-                <property name="receives_default">True</property>
-                <property name="tooltip_text" translatable="yes">Open menu</property>
+                <property name="can-focus">True</property>
+                <property name="focus-on-click">False</property>
+                <property name="receives-default">True</property>
+                <property name="tooltip-text" translatable="yes">Open menu</property>
                 <property name="popover">pop_more</property>
                 <child>
                   <object class="GtkImage">
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="icon_name">view-more-symbolic</property>
+                    <property name="can-focus">False</property>
+                    <property name="icon-name">view-more-symbolic</property>
                   </object>
                 </child>
               </object>
               <packing>
-                <property name="pack_type">end</property>
+                <property name="pack-type">end</property>
                 <property name="position">2</property>
               </packing>
             </child>
             <child>
               <object class="GtkButton" id="btn_noconnection">
                 <property name="visible">True</property>
-                <property name="can_focus">True</property>
-                <property name="receives_default">True</property>
-                <property name="tooltip_text" translatable="yes">You don't seem connected to the internet. Without it you will not be able to download essential components. Click this icon when you have reestablished the connection.</property>
+                <property name="can-focus">True</property>
+                <property name="receives-default">True</property>
+                <property name="tooltip-text" translatable="yes">You don't seem connected to the internet. Without it you will not be able to download essential components. Click this icon when you have reestablished the connection.</property>
                 <child>
                   <object class="GtkImage">
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="icon_name">network-error-symbolic</property>
+                    <property name="can-focus">False</property>
+                    <property name="icon-name">network-error-symbolic</property>
                     <property name="icon_size">2</property>
                   </object>
                 </child>
               </object>
               <packing>
-                <property name="pack_type">end</property>
+                <property name="pack-type">end</property>
                 <property name="position">3</property>
               </packing>
             </child>
             <child>
               <object class="GtkButton" id="btn_back">
-                <property name="can_focus">True</property>
-                <property name="receives_default">True</property>
-                <property name="tooltip_text" translatable="yes">Go back</property>
+                <property name="can-focus">True</property>
+                <property name="receives-default">True</property>
+                <property name="tooltip-text" translatable="yes">Go back</property>
                 <child>
                   <object class="GtkImage">
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="icon_name">go-previous-symbolic</property>
+                    <property name="can-focus">False</property>
+                    <property name="icon-name">go-previous-symbolic</property>
                   </object>
                 </child>
                 <accelerator key="Escape" signal="activate"/>
@@ -307,14 +307,14 @@
             <child>
               <object class="GtkButton" id="btn_add">
                 <property name="visible">True</property>
-                <property name="can_focus">True</property>
-                <property name="receives_default">True</property>
-                <property name="tooltip_text" translatable="yes">New bottle</property>
+                <property name="can-focus">True</property>
+                <property name="receives-default">True</property>
+                <property name="tooltip-text" translatable="yes">New bottle</property>
                 <child>
                   <object class="GtkImage">
                     <property name="visible">True</property>
-                    <property name="can_focus">False</property>
-                    <property name="icon_name">list-add-symbolic</property>
+                    <property name="can-focus">False</property>
+                    <property name="icon-name">list-add-symbolic</property>
                   </object>
                 </child>
               </object>
@@ -332,17 +332,102 @@
             <property name="position">0</property>
           </packing>
         </child>
+        <child>
+          <object class="GtkInfoBar">
+            <property name="visible">True</property>
+            <property name="can-focus">False</property>
+            <child internal-child="action_area">
+              <object class="GtkButtonBox">
+                <property name="can-focus">False</property>
+                <property name="spacing">6</property>
+                <property name="layout-style">end</property>
+                <child>
+                  <object class="GtkButton" id="btn_fpk_pkgs">
+                    <property name="label" translatable="yes">Other packages</property>
+                    <property name="visible">True</property>
+                    <property name="can-focus">True</property>
+                    <property name="receives-default">True</property>
+                  </object>
+                  <packing>
+                    <property name="expand">True</property>
+                    <property name="fill">True</property>
+                    <property name="position">0</property>
+                  </packing>
+                </child>
+                <child>
+                  <object class="GtkButton" id="btn_fpk_info">
+                    <property name="label" translatable="yes">More info</property>
+                    <property name="visible">True</property>
+                    <property name="can-focus">True</property>
+                    <property name="receives-default">True</property>
+                  </object>
+                  <packing>
+                    <property name="expand">True</property>
+                    <property name="fill">True</property>
+                    <property name="position">1</property>
+                  </packing>
+                </child>
+                <child>
+                  <placeholder/>
+                </child>
+              </object>
+              <packing>
+                <property name="expand">False</property>
+                <property name="fill">False</property>
+                <property name="position">0</property>
+              </packing>
+            </child>
+            <child internal-child="content_area">
+              <object class="GtkBox">
+                <property name="can-focus">False</property>
+                <property name="spacing">16</property>
+                <child>
+                  <object class="GtkLabel">
+                    <property name="visible">True</property>
+                    <property name="can-focus">False</property>
+                    <property name="label" translatable="yes">Flatpak version of Bottles has been deprecated. Move to another package as soon as possible.</property>
+                  </object>
+                  <packing>
+                    <property name="expand">True</property>
+                    <property name="fill">True</property>
+                    <property name="position">0</property>
+                  </packing>
+                </child>
+                <child>
+                  <placeholder/>
+                </child>
+                <child>
+                  <placeholder/>
+                </child>
+              </object>
+              <packing>
+                <property name="expand">False</property>
+                <property name="fill">False</property>
+                <property name="position">0</property>
+              </packing>
+            </child>
+            <child>
+              <placeholder/>
+            </child>
+          </object>
+          <packing>
+            <property name="expand">False</property>
+            <property name="fill">True</property>
+            <property name="position">1</property>
+          </packing>
+        </child>
         <child>
           <object class="GtkStack" id="stack">
-            <property name="width_request">360</property>
-            <property name="height_request">200</property>
+            <property name="width-request">360</property>
+            <property name="height-request">200</property>
             <property name="visible">True</property>
-            <property name="can_focus">False</property>
+            <property name="can-focus">False</property>
             <property name="vexpand">True</property>
             <child>
+              <!-- n-columns=3 n-rows=3 -->
               <object class="GtkGrid" id="grid_main">
                 <property name="visible">True</property>
-                <property name="can_focus">False</property>
+                <property name="can-focus">False</property>
                 <child>
                   <placeholder/>
                 </child>
@@ -376,13 +461,13 @@
           <packing>
             <property name="expand">False</property>
             <property name="fill">True</property>
-            <property name="position">1</property>
+            <property name="position">2</property>
           </packing>
         </child>
         <child>
           <object class="HdyViewSwitcherBar" id="view_switcher_bar">
             <property name="visible">True</property>
-            <property name="can_focus">False</property>
+            <property name="can-focus">False</property>
             <property name="policy">auto</property>
             <property name="stack">stack</property>
             <property name="reveal">True</property>
@@ -390,7 +475,7 @@
           <packing>
             <property name="expand">False</property>
             <property name="fill">True</property>
-            <property name="position">2</property>
+            <property name="position">3</property>
           </packing>
         </child>
       </object>
@@ -398,8 +483,8 @@
   </template>
   <object class="GtkStack" id="stack_main">
     <property name="visible">True</property>
-    <property name="can_focus">False</property>
-    <property name="transition_type">crossfade</property>
+    <property name="can-focus">False</property>
+    <property name="transition-type">crossfade</property>
     <child>
       <placeholder/>
     </child>
diff --git a/src/window.py b/src/window.py
index db74b25..fadb3ff 100644
--- a/src/window.py
+++ b/src/window.py
@@ -60,6 +60,8 @@ class BottlesWindow(Handy.ApplicationWindow):
     btn_noconnection = Gtk.Template.Child()
     btn_versioning = Gtk.Template.Child()
     btn_installers = Gtk.Template.Child()
+    btn_fpk_info = Gtk.Template.Child()
+    btn_fpk_pkgs = Gtk.Template.Child()
     box_downloads = Gtk.Template.Child()
     pop_downloads = Gtk.Template.Child()
     squeezer = Gtk.Template.Child()
@@ -140,6 +142,8 @@ class BottlesWindow(Handy.ApplicationWindow):
         self.btn_taskmanager.connect('pressed', self.show_taskmanager_view)
         self.btn_importer.connect('pressed', self.show_importer_view)
         self.btn_noconnection.connect('pressed', self.check_for_connection)
+        self.btn_fpk_info.connect('pressed', self.open_flatpak_notice)
+        self.btn_fpk_pkgs.connect('pressed', self.open_other_packages)
         self.squeezer.connect('notify::visible-child', self.on_squeezer_notify)
 
         '''BottlesDetail signal connections'''
@@ -219,6 +223,12 @@ class BottlesWindow(Handy.ApplicationWindow):
     def open_docs_url(widget):
         webbrowser.open_new_tab("https://docs.usebottles.com")
 
+    def open_flatpak_notice(self, widget):
+        webbrowser.open_new_tab("https://mirko.pm/blog/bottles-will-leave-flatpak/")
+
+    def open_other_packages(self, widget):
+        webbrowser.open_new_tab("https://usebottles.com/download/")
+
     '''Go back to previous page'''
     def go_back(self, widget=False):
         self.hide_view_switcher()
-- 
2.32.0

